generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(uuid())
  email           String           @unique
  password        String
  createdAt       DateTime         @default(now())
  homes           Home[]
  loginActivities LoginActivity[]
  billingAccount  BillingAccount?
  userTasks       UserTask[]
  aiQueries       AIQueryHistory[]
}

model LoginActivity {
  id        String   @id @default(uuid())
  userId    String
  ip        String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Home {
  id                 String   @id @default(cuid())
  userId             String
  address            String
  city               String
  state              String
  nickname           String?
  squareFeet         Int?
  lotSize            Float?
  yearBuilt          Int?
  numberOfRooms      Int?
  architecturalStyle String?
  features           String[]
  imageUrl           String?
  isChecked          Boolean  @default(true)
  createdAt          DateTime @default(now())

  boilerType         String?
  hasCentralAir      Boolean  @default(false)
  hasBaseboard       Boolean  @default(false)
  roofType           String?
  sidingType         String?

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  rooms       Room[]       @relation("HomeRooms")
  trackables  Trackable[]  @relation("HomeTrackables")
  lawnProfile LawnProfile?
  vehicles    Vehicle[]    @relation("HomeVehicles")
}


model Room {
  id     String @id @default(cuid())
  name   String
  type   String
  floor  Int?
  home       Home        @relation("HomeRooms", fields: [homeId], references: [id], onDelete: Cascade)
  homeId String
  trackables Trackable[] @relation("RoomTrackables")
  tasks     Task[]
}

model LawnProfile {
  id                  String   @id @default(uuid())
  homeId              String   @unique
  squareFeet          Int?
  usesLawnService     Boolean? @default(false)
  soilType            String?
  sunExposure         String?
  irrigationInstalled Boolean? @default(false)
  createdAt           DateTime @default(now())

  home Home @relation(fields: [homeId], references: [id], onDelete: Cascade)
}

model Vehicle {
  id        String   @id @default(cuid())
  homeId    String
  nickname  String?
  type      String
  make      String?
  model     String?
  year      Int?
  vin       String?
  mileage   Int?
  imageUrl  String?
  createdAt DateTime @default(now())

  home Home @relation("HomeVehicles", fields: [homeId], references: [id], onDelete: Cascade)
}

model ApplianceCatalog {
  id        String   @id @default(uuid())
  brand     String
  model     String
  type      String
  category  String
  notes     String?
  imageUrl  String?
  createdAt DateTime @default(now())

  applianceTaskTemplates ApplianceTaskTemplate[]
  trackables             Trackable[]

  @@unique([brand, model])
}

model Trackable {
  id                 String    @id @default(uuid())
  homeId             String
  roomId             String?
  applianceCatalogId String?
  userDefinedName    String?
  purchaseDate       DateTime?
  serialNumber       String?
  imageUrl           String?
  notes              String?
  createdAt          DateTime  @default(now())

  home             Home              @relation("HomeTrackables", fields: [homeId], references: [id], onDelete: Cascade)
  room             Room?             @relation("RoomTrackables", fields: [roomId], references: [id], onDelete: Cascade)
  applianceCatalog ApplianceCatalog? @relation(fields: [applianceCatalogId], references: [id])

  tasks UserTask[]
}

model Task {
  id        String   @id @default(cuid())
  name      String
  roomId    String
  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model TaskTemplate {
  id                 String          @id @default(uuid())
  title              String
  description        String?
  icon               String?
  imageUrl           String?
  category           String?
  recurrenceInterval String
  taskType           TaskType
  criticality        TaskCriticality @default(medium)

  canDefer             Boolean @default(true)
  deferLimitDays       Int     @default(0)
  estimatedTimeMinutes Int     @default(30)
  estimatedCost        Int     @default(0)
  canBeOutsourced      Boolean @default(false)

  steps           String[] @default([])
  equipmentNeeded String[] @default([])
  resources       Json?

  createdAt DateTime @default(now())

  userTasks             UserTask[]
  ApplianceTaskTemplate ApplianceTaskTemplate[]
}

model ApplianceTaskTemplate {
  id                 String  @id @default(uuid())
  applianceCatalogId String
  taskTemplateId     String
  notes              String?

  applianceCatalog ApplianceCatalog @relation(fields: [applianceCatalogId], references: [id], onDelete: Cascade)
  taskTemplate     TaskTemplate     @relation(fields: [taskTemplateId], references: [id], onDelete: Cascade)

  @@unique([applianceCatalogId, taskTemplateId])
}

model UserTask {
  id             String  @id @default(uuid())
  userId         String
  trackableId    String
  taskTemplateId String?

  title         String
  description   String
  dueDate       DateTime
  completedDate DateTime?
  status        TaskStatus

  itemName String
  category String
  location String?

  estimatedTimeMinutes Int
  estimatedCost        Int
  criticality          TaskCriticality
  deferLimitDays       Int
  canBeOutsourced      Boolean
  canDefer             Boolean

  recurrenceInterval String
  taskType           TaskType

  steps           Json?
  equipmentNeeded Json?
  resources       Json?

  imageUrl String?
  icon     String?

  createdAt DateTime @default(now())

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  trackable    Trackable     @relation(fields: [trackableId], references: [id], onDelete: Cascade)
  taskTemplate TaskTemplate? @relation(fields: [taskTemplateId], references: [id])
}

model BillingAccount {
  id               String    @id @default(uuid())
  userId           String    @unique
  stripeCustomerId String?
  plan             String
  status           String
  trialEndsAt      DateTime?
  createdAt        DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AIQueryHistory {
  id              String   @id @default(uuid())
  userId          String?
  query           String
  source          String?
  responseSummary String?
  createdAt       DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum TaskStatus {
  PENDING
  COMPLETED
  SKIPPED
}

enum TaskCriticality {
  low
  medium
  high
}

enum TaskType {
  GENERAL
  AI_GENERATED
  USER_DEFINED
}
