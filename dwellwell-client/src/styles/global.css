@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================================================
   THEME TOKENS
   - Light tokens live on :root
   - Dark tokens override on .dark (html.dark)
   - Families (.theme-*) layer on top of either mode
   - All tokens use space-separated RGB for easy `rgb(var(--token) / <alpha>)`
============================================================================ */

@layer base {
  /* ---------- Light (default) ---------- */
  :root {
    /* surfaces */
    --surface: 255 255 255;         /* page background */
    --surface-alt: 246 248 250;     /* secondary bg (cards, headers) */
    --card: 255 255 255;

    /* text */
    --text: 17 24 39;               /* gray-900 */
    --muted: 107 114 128;           /* gray-500 */

    /* borders & focus */
    --border: 229 231 235;          /* gray-200 */
    --ring: 59 130 246;             /* blue-500 */

    /* brand & states */
    --primary: 37 99 235;           /* blue-600 (default family) */
    --accent: 79 70 229;            /* indigo-600 (fallback accent) */
    --success: 16 185 129;          /* emerald-500 */
    --warning: 245 158 11;          /* amber-500 */
    --danger: 239 68 68;            /* red-500 */

    /* misc */
    --on-primary: 255 255 255;      /* text on primary */
    --radius: 14px;
    --font-scale: 1;
  }

  :root {
    color-scheme: light;
    font-size: calc(16px * var(--font-scale));
  }

  /* ---------- Dark (html.dark) ---------- */
  .dark {
    --surface: 17 24 39;            /* gray-900 */
    --surface-alt: 31 41 55;        /* gray-800 */
    --card: 24 33 46;               /* deep slate/blue */

    --text: 243 244 246;            /* gray-100 */
    --muted: 156 163 175;           /* gray-400 */

    --border: 55 65 81;             /* gray-700 */
    --ring: 129 140 248;            /* indigo-400 */

    --primary: 217 70 239;          /* fuchsia-500 (nice in dark) */
    --accent: 234 88 12;            /* orange-600 */

    --success: 16 185 129;          /* emerald-500 */
    --warning: 245 158 11;          /* amber-500 */
    --danger: 248 113 113;          /* red-400 */

    --on-primary: 17 24 39;         /* dark text on bright primaries */
    color-scheme: dark;
  }

  /* ---------- Style families (overlay on light or dark) ---------- */
  .theme-default { /* no-op; uses base tokens */ }

  .theme-calm {
    --primary: 59 130 246;          /* blue-500 */
    --accent: 94 234 212;           /* teal-300 */
    --surface-alt: 240 249 255;     /* blue-50 */
  }

  .theme-bold {
    --primary: 217 70 239;          /* fuchsia-500 */
    --accent: 234 88 12;            /* orange-600 */
    --surface-alt: 250 245 255;     /* fuchsia-50 */
  }

  .theme-forest {
    --primary: 34 197 94;           /* green-500 */
    --accent: 16 185 129;           /* emerald-500 */
    --surface-alt: 240 253 244;     /* green-50 */
  }

  .theme-solar {
    --primary: 245 158 11;          /* amber-500 */
    --accent: 2 132 199;            /* sky-600 */
    --surface-alt: 254 249 195;     /* amber-50 */
  }

  /* ---------- Base paint ---------- */
  * { border-color: rgb(var(--border) / 1); }

  body {
    background-color: rgb(var(--surface) / 1);
    color: rgb(var(--text) / 1);
  }
}

/* ============================================================================
   SEMANTIC UTILITIES
   (tokenized helpers you can use anywhere)
============================================================================ */

@layer utilities {
  /* backgrounds */
  .bg-surface      { background-color: rgb(var(--surface) / 1); }
  .bg-surface-alt  { background-color: rgb(var(--surface-alt) / 1); }
  .bg-card         { background-color: rgb(var(--card) / 1); }
  .bg-primary      { background-color: rgb(var(--primary) / 1); }
  .bg-accent       { background-color: rgb(var(--accent) / 1); }

  /* soft primary background (for active pills/badges) */
  .bg-primary-soft { background-color: rgb(var(--primary) / 0.10); }

  /* text colors */
  .text-body       { color: rgb(var(--text) / 1); }
  .text-muted      { color: rgb(var(--muted) / 1); }
  .text-on-primary { color: rgb(var(--on-primary) / 1); }
  .text-primary    { color: rgb(var(--primary) / 1); }

  /* borders & rings */
  .border-token    { border-color: rgb(var(--border) / 1); }
  .border-primary  { border-color: rgb(var(--primary) / 1); }

  .ring-primary    { --tw-ring-color: rgb(var(--primary) / 1); }
  .ring-accent     { --tw-ring-color: rgb(var(--accent) / 1); }

  /* quick radius aliases mapped to design token */
  .rd-sm { border-radius: calc(var(--radius) - 4px); }
  .rd-md { border-radius: calc(var(--radius) - 2px); }
  .rd-lg { border-radius: var(--radius); }

  /* focus style that works in both modes */
  .focus-ring {
    @apply focus:outline-none focus:ring-2;
    --tw-ring-color: rgb(var(--ring) / 1);
  }
}

/* ============================================================================
   COMPONENT PRIMITIVES
   (used across pages; color-safe in both modes)
============================================================================ */

@layer components {
  .panel         { @apply bg-card text-body border border-token rounded-xl; }
  .panel-hover   { @apply hover:border-primary/50; }
  .token-btn     { @apply inline-flex items-center justify-between rounded-xl border border-token bg-card text-body px-3 py-2; }
  .token-menu    { @apply panel shadow-xl p-1; }

  /* Surfaces */
  .surface-card    { @apply border rounded-2xl bg-card; }
  .surface-card-sm { @apply border rounded-lg bg-card; }

  /* Tabs */
  .tab-btn {
    @apply px-3 py-2 text-sm -mb-px border-b-2 mr-1 transition-colors
           border-transparent text-slate-600 hover:text-brand-primary
           dark:text-slate-300 dark:hover:text-white dark:hover:border-slate-500;
  }
  .tab-btn--active { @apply border-brand-primary text-brand-primary font-semibold; }

  /* Status chips */
  .chip         { @apply rounded px-1.5 py-0.5 text-[11px] border; }
  .chip-danger  { @apply chip bg-red-50 text-red-700 border-red-200 dark:bg-red-950/30 dark:text-red-300 dark:border-red-900/40; }
  .chip-warn    { @apply chip bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-950/30 dark:text-amber-300 dark:border-amber-900/40; }
  .chip-neutral { @apply chip bg-slate-50 text-slate-700 border-slate-200 dark:bg-slate-900/40 dark:text-slate-200 dark:border-slate-800; }
}

/* --------------------------------------------------------------------------
   Tiny reset to keep borders & body color in sync with tokens
-------------------------------------------------------------------------- */
@layer base {
  *   { --tw-border-opacity: 1; border-color: rgb(var(--border) / var(--tw-border-opacity)); }
  body{ background-color: rgb(var(--surface) / 1); color: rgb(var(--text) / 1); }
}
